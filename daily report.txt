
سلام علیکم
گزارش 14040612

با payload 300 بایت udp زدم

- رفتار عجیبی که دارم مشاهد همی کنم با همان تنظیمات دیروز که امروز می زنم اصلا نتایج شبیه دیروز نیست و جالبه لاست داریم حتی را ریت کمتر





----------

سلام علیکم
گزارش 14040611

حداکثر ارسال دیتای udp شد 120 مگابایت بر ثانیه با ارسال 1470 بایت در payload و سایز فریم 1512بایت و 0.169 درصد لاست داشتم
با سرعت 43 مگابایت udp ارسال کنیم هیچ لاستی نخواهیم داشت ، دریافت با pcap و در virtual machine



در ادامه گزارشم هم این موارد را بگویم که در چت هامون بماند:
- wget هم که ریت بیشتری داشت بدلیل اندازه بیشتر پکت ها بود که از MTU رد می شد
- برای ارسال با ریت مشخص هم یک برنامه دیگر نوشتم زیرا سیستم وقفه اندازی به میزانی که مورد نیاز است قابل تنظیم نیست


یک نکته ای هم به ذهنم رسید که در کتاب خوندم اینکه وقتی تابع udp send بر می گردد و می گوید اوکی در واقع دارد می گوید که این مقدار بایت روی حافظه data link کپی شد

یک مقدار کد خودم رو تغییر دادم که امکان ارسال تعداد محدودی پکت با ریت مشخص ایجاد شود

وقتی فاصله زمانی دو ارسال را یک نانو گذاشتم 15 هزار تا ارسال شد





خواستم دیتا با ریت 120 مگا بایت بفرستم هم nping را تست کردم و هم hping را . یکی توقف نداشت روی تعداد پکت و دیگری حداکثر 50 مگ توانست ارسال کند. برنامه خودم هم که ارسال می کرد با اینکه بهش گفته بودم فاصله هر ارسال در حد 1 نانو باشد ولی در عمل فاصله زمانی بیشتر بود که باید ببینم مشکل کجاست و چپونه می توان باند ریت داد و گقت این تعداد پکت را با ریت فلان بفرست






------------

سلام علیکم
گزارش 14040609

چون برنامم را برای کانفیگ تک ردیفه نوشته بودم اصلاحش کردم که بشود چند Bridge بودن را هندل کند یعنی گروه های مختلفی از ورودی به خروجی ها و با نحوه تعامل قبول کند و همه را اعمال کند

--------------

سلام علیکم
گزارش 14040608

- یک تست کوچکی روی AF_PACKET رفتم که روی سوکت را پیاده شده و در کنار آن از mmap استفاده کردم ببینم نتیجه بهتری در لاست دارد و یا نه که همون نتایج قبلی رو داشت از گروک هم پرسیدم گفت ماشین مجازی اعتباری بهش نیست
- پیاده سازی کانفیگ های چند تایی رو شروع کردم یعنی چندین نوع اتصال درون برنامه هندل شود


--------------------------------

سلام علیکم
گزارش 14040605

امروز کار کانفیگ میکس تموم شد و تست کردم و امکان پخش کردن پکت های udp بین چند تاtcp وجود داشت
این موارد در گیت هم قرار گرفت



-------------

سلام علیکم
گزارش 14040604

امروز همچنان درگیر کانفیگ میکس بودم. یکم سخت تر از چیزی که فکر میکردم و نیاز به کار بیشتری دارد و فردا فکر می کنم یک نمونه اولیه که کانفیگ هم رپلیکیت کند و هم راند رابین کند تحویل میدهم.

-------------

سلام علیکم
گزارش 14040603

صبح روی NAPI , BUSY_POLL , CPU_AFFINITY , کار کردم و تاثیر ناچیزی داشت

در ادامه روی پیاده سازی عملیاتی شدن کانفیگی که بتواند خروجی راند رابین و رپلیکیت داشته باشد کار کردم و کار کمی باقی مانده تا این مورد که سخت ترین مدل کانفیگ هست پیاده شود 


--------

سلام علیکم
گزارش 14040601

امروز بر روی پیاده سازی عملیاتی شدن کانفیگی که بتواند خروجی راند رابین و رپلیکیت داشته باشد کار کردم.



------------------------

سلام علیکم
گزارش 14040529

-چون دیدم حساسیت نسبت به لاست زیاد است و راه حل PACKET_FANOUT هم نتوانست جلوی لاست را بگیرد بدلیل زیر
It does not fundamentally reduce the per-packet processing cost in the kernel.
At very high rates (10G, 40G, 100G links), AF_PACKET + fanout may still drop packets, while XDP or DPDK can handle line rate.
بنابر این یک تستی هم روی eBPF رفتم ولی نشد یعنی این روش خیلی مشابه FANOUT بود با این تفاوت که نحوه یتقسیم پکت ها با کد ما که با CLANG کام÷ایل می شود تقسیم می شود که البته این روش کار نکرد
-روش دیگری که تست کردم این بود که چند تا ترد همزمان سوکت برای یک پورت را باز کنند و در واقع فشار بیشتری بگذارم روی یک پورت برای خواندم که این مورد هم لاست داشت
- کار دیگری که کردم حذف لاک circular buffer بود


سلام علیکم
گزارش 14040528

-امروز متوجه شدم با تابع pthread_cond_wait کاری که میخواستم انجام بدهم قابل انجام بود. یعنی میخواستم درج در بافر بدون توقف صورت گیرد ولی خواندن از بافر هر زمانی که امکان پذیر بود صورت گیرد.
-یک زمان سنجی هم کردم در خصوص اینکه استفاده از این بافر به نسبت صرفا شمارش پکت های دریافتی چقدر لاست دارد که یک دهم درصد متاسفانه رسید به 2 درصد لاست. 
-حالا راههای دیگری برای کاهش لاست به ذهنم رسید مثلا در سطح کرنل اسپیس udp ها رو پخش کنیم بین چند مقصد و این مقاصد هر کدام سهمی از کل داده دریافتی دریافت کند
-راه دیگری هم به ذهنم رسید که چند ترد روی یک پورت قرار گیرد همزمان با هرچه قدرت دارند بگذارند برای دریافت پکت که اینرا فردا امتحان می کنم.


سلام علیکم
گزارش 14040527

امروز دریافت udp با pcap و ارسالش با tcp به سرور ثالث رو انجام دادم فقط یک نکته پیش آمد و آن اینست که circular buffer ای می خواهم که وفتی دیتا ندارد لاک کند ولی این لاک منجر نشود که دیتای جدید وارد شود و امکان گرفتن دیتای جدید فراهم باشد تا ارسال و دریافت بهم کاری نداشته باشند



منظورم این بود که هر زمان فرستنده داده ای فرستاد در این بافر ذخیره شود ولی برای گیرنده و سمتی که قرار است دیتا بگیریم و tcp بفرستیم اگر خود این بافر wait برای بافر خالی را هندل کند مطلوب ما خواهد بود زیرا در صورت نبود این Wait ترد ارسال کننده Tcp بسیار زمان cpu را خواهد گرفت


سلام علیکم
گزارش 14040526

همچنان مشغولم به ایجاد امکان گرفتن پکت از طریق pcap و ارسال اون روی tcp به طرف مقابل
مشکل کارم این است که circular buffer ای که دارم اگر ظرفیتش پر شود لاک می شود برای همین مشغولم به ساخت مدل دیگری که لاک نشود و به جای آن لاست داشته باشیم و البته سعی کنم لاست هم سمت Tcp نداشته باشیم در مرحله ی بعد


سلام علیکم
گزارش 14040525

صبح دو سه ساعتی در خصوص روش lockless و compare and swap کار کردم و می خواهم بعد از کارم بیشتر رویش کار کنم تا buffer هایم بدون لاک گردد
بر روی دریافت بوسیله pcap در برنامه کارکردم که کار افتاد و درصد لاست کمتری در حجم ارسالی بالا در حد MTU دارد
بر روی دریافت از طریق pcap و ارسال به Tcpدارد کار می کنم

---------------

سلام علیکم
گزارش 14040522
کار بر روی پروژه protocol bridge ادامه یافت
حالت های ساده کانفیگ جدید در برنامه اجرایی شد و شروع پیاده سازی کانفیگ های پیچیده تر از روز کاری بعدی آغاز می گردد
کاری که به موازات این کد نویسی در حال انجام است پیدا کردن هر موضوعی که بتوانم در این پروژه بکار گیرم تا عملکرد مطلوب تری از خود نشان دهد
مثلا سعی دارم Test case بنویسم و راهی پیدا کنم که قسمت های برنامه ام قابل تست باشد


---------------

سلام علیکم
گزارش 14040521
همچنان بر روی برنامه protocol bridge کار کردم
پیاده سازی تنظیمات تو در تو و انتقال این به برنامه وقت گیر شد که در حال انجام است

-------------------

سلام علیکم
گزارش 14040520
بر روی برنامه protocol bridge کار انجام شد
کد برنامم یک مقدار زیاد شده بود و غیر قابل فهم برای همین ماژول بندی گردید
در ادامه برای اعمال تنظیمات چند گانه ای که مطرح شد کد نویسی شروع گردید که بدلیل اینکه برنامه ای که از قبل بود برای وضعیت ساده ای طراحی شد تقریبا همه چیز کامنت شد تا بعد از بررسی و مطابق با خواسته های جدید مجدد بازنویسی شود و یا با تغییرات جزئی مجدد استفاده گردد

---------------------

سلام . ارادتمندم
گزارش 14040519
-شکل تنظیمات برای نگاهداری ساختار ترکیبی مورد نیاز ایجاد شد
- یوز کیس ها برای پیاده سازی و امکان اجرای این شکل ترکیبی در حال اجراست
- کد نویسی برای اجرای این تنظیمات ترکیبی شروع شد و در مراحل مقدماتیش هستم

گزارش 14040519

---------------

گزارش 14040518

-امروز تلاش کردم ببینم میشه ارسال پکت را با pfring انجام بدهم ولی با تلاش زیاد متوجه شدم که این کار نیاز به کارت شبکه واقعی داره و در ماشین مجازی امکان پذیر نیست
برای دریافت DPDK را هم رفتم یک نگاهی کردم ولی این موارد چون نیاز دارد به NIC سخت افزاری که فعلا ممکن نبود پس به این نتیجه رسیدم به نحوی برنامه را بنویسم که امکان استفاده از ابزار های جدید را در سریعترین زمان مکن سازم
-یک مشکلی هم داشتم برای debug ام که خیلی طول می کشید که عاملش ماشین مقصد بود که برای اون هم دو سه ساعتی وقتم رفت
-کاری که آغاز کردم تهیه ساختار مورد نیاز برای تنظمیات و تکمیل پروژه ام است


اجرای برنامم خیلی طول می کشید سر  لود
ld-linux-x86-64.so.2
که کاری کردم که با یوزر root بروم در اس اس اچ در نتیجه فایل را می دید
فکر کنم مشکلش اینطوری رفع شد

خواستم ارسال یو دی پی و تبدیلش به تی سی پی را روی پی اف رینگ بزنم
لازم شد pf_ringctl را راه بندازم
ولی نشد چون روی ویرتوال باکس نمی شد بخاطر شبکه مجازی اون

14040518
---------------

14040512

-----------

مشغول کشتس گرفتن با ابزار های ارسال پکت و برنامه دیده بان پکت ها بودم که موارد خوبی را پیدا کنم

ولی خیلی طول کشید چون این ابزار ها پیدا کردم ورودی های صحیح که خروجی خوب بدهد سخت است

14040505

-----------

امروز ارزیابی میزان استفاده از ÷هنای باند ابزار wget از فایل سرور های مختلف تست شد

برای برنامه تولید پکت امکان تولید تعدادی پکت مهیا شد

14040504

--------------

امکان ایجاد ریست زمان و هماهنگ شدن چند برنامه با هم


14040429

------------

مشکل محاسباتم رو پیدا کردم. من فقط پی لود را حساب کردم و مثلا
iftop
کل پکت دریفاتی را محاسبه کرده

14040425

-----------

system alive check

مشکل گیر کردن برنامم یا از اورران بافر است که من دیتای دریافتی را بلافاصله می خواستم روی تی سی ÷ی بفرستم که مشکل این شد که طول می دهد در نتیجه بافر یو دی پی پر می شود

14040423

--------

برنامه های ساخت پکت و بریدج برای یو دی پی به تس سی پی و دریفات تی سی پی را راه انداختم و یک نمایش اولیه از گزارش کار و میزان ریت انقال دیتا به آقای حمیدی نمایش دادم

عدد انتقال wget را بدست آوردم بطور میانگین

14040422

----------------

کار برنامه ساخت پکت udp تمام شد

دارم همان روش را روی برنامه bridge تست می کنم

14040421
